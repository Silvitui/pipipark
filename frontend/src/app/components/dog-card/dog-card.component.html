<div class="card w-80 border-2 border-purple-400 rounded-2xl shadow-lg bg-white">
  <div class="flex flex-col items-center p-4">
    <img
      [src]="previewUrl() || dog.photo"
      alt="Foto de {{ dog.name }}"
      class="w-32 h-32 object-cover rounded-full ring-4 ring-purple-300 shadow-md mb-3"
    />
    <h2 class="text-xl font-bold text-purple-700 mb-2">
      @if (!editing()) {
        {{ dog.name }}
      } @else {
        <input [(ngModel)]="form().name" class="input input-sm input-bordered w-full" />
      }
    </h2>

    <div class="w-full space-y-1 text-sm">
      <div class="bg-purple-50 p-2 rounded-md">
        <strong>Raza:</strong>
        @if (!editing()) {
          {{ dog.breed }}
        } @else {
          <input [(ngModel)]="form().breed" class="input input-sm input-bordered w-full" />
        }
      </div>

      <div class="bg-purple-50 p-2 rounded-md">
        <strong>Fecha de nacimiento:</strong>
        @if (!editing()) {
          {{ dog.birthday | date: 'longDate' }}
        } @else {
          <input type="date" [(ngModel)]="form().birthday" class="input input-sm input-bordered w-full" />
        }
      </div>

      <div class="bg-purple-50 p-2 rounded-md">
        <strong>Tamaño:</strong>
        @if (!editing()) {
          {{ dog.size }}
        } @else {
          <select [(ngModel)]="form().size" class="select select-sm select-bordered w-full">
            <option value="pequeño">Pequeño</option>
            <option value="mediano">Mediano</option>
            <option value="grande">Grande</option>
          </select>
          
        }
      </div>

      <div class="bg-purple-50 p-2 rounded-md">
        <strong>Género:</strong>
        @if (!editing()) {
          {{ dog.gender }}
        } @else {
          <select [(ngModel)]="form().gender" class="select select-sm select-bordered w-full">
            <option value="macho">Macho</option>
            <option value="hembra">Hembra</option>
          </select>
        }
      </div>

      <div class="bg-purple-50 p-2 rounded-md">
        <strong>Castrado:</strong>
        @if (!editing()) {
          {{ dog.castrated ? 'Sí' : 'No' }}
        } @else {
          <select [(ngModel)]="form().castrated" class="select select-sm select-bordered w-full">
            <option [ngValue]="true">Sí</option>
            <option [ngValue]="false">No</option>
          </select>
        }
      </div>

      <div class="bg-purple-50 p-2 rounded-md">
        <label class="block text-sm font-medium text-gray-700 mb-1">Personalidad:</label>
      
        @if (!editing()) {
          <div class="flex flex-wrap gap-2 mt-1">
            <span *ngFor="let tag of dog.personality" class="badge badge-outline badge-purple">
              {{ tag }}
            </span>
          </div>
        } @else {
          <div
            class="relative w-full"
            (click)="togglePersonalityEditor()"
          >
          <div class="input input-bordered w-full flex items-center justify-between bg-white text-sm cursor-pointer">

              <span class="truncate">
                {{ form().personality?.length ? form().personality?.join(', ') ?? '' : 'Selecciona una o varias opciones' }}
              </span>
              <svg
                [ngClass]="{ 'rotate-180': showPersonalityOptions() }"
                class="w-4 h-4 text-gray-500 transition-transform duration-300 ml-2"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </div>
      
          @if (showPersonalityOptions()) {
            <div class="grid grid-cols-2 gap-2 mt-2">
              <label
                *ngFor="let trait of personalityOptions"
                class="cursor-pointer flex items-center gap-2 p-1 px-2 border rounded-md transition hover:bg-purple-100"
                [ngClass]="{ 'bg-purple-200 text-purple-800 font-medium': form().personality?.includes(trait) }"
              >
                <input
                  type="checkbox"
                  [checked]="form().personality?.includes(trait)"
                  (change)="togglePersonality(trait)"
                  class="checkbox checkbox-sm checkbox-primary"
                />
                {{ trait }}
              </label>
            </div>
          }
        }
      </div>
      
    <input type="file" (change)="onFileSelected($event)" class="file-input file-input-bordered w-full mt-4" />
    <button
      class="btn btn-outline btn-primary mt-2"
      (click)="onUpload()"
      [disabled]="!selectedFile() || loading()"
    >
      {{ loading() ? 'Subiendo...' : 'Subir foto' }}
    </button>
    <div class="mt-4 flex gap-2">
      @if (!editing()) {
        <button class="btn btn-outline btn-info btn-sm" (click)="startEditing()">Editar</button>
      } @else {
        <button class="btn btn-sm btn-success" (click)="saveDogChanges()">Guardar</button>
        <button class="btn btn-sm btn-outline" (click)="cancelEdit()">Cancelar</button>
      }
    </div>
  </div>
</div>